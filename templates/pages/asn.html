{% extends 'base.html' %}

{% block title %}
AS{{ asn }} {{ as_name }}
{% endblock %}

{% block headers %}
<!-- IBM Carbon Components -->
<script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.31.0/dropdown.min.js"></script>
<script type="module" src="https://1.www.s81c.com/common/carbon/web-components/version/v2.25.2/text-input.min.js"></script>
<!-- IBM Carbon Charts -->
<script src="https://cdn.jsdelivr.net/npm/@carbon/charts@1/dist/umd/bundle.umd.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/@carbon/charts@1/styles.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="content__asn">
    <div class="asn__header">
        <div class="header__wrapper">
            <div class="wrapper__container">
                <div class="container__breadcrumbs">
                    <a href="/" class="breadcrumbs__item">Home</a>
                </div>
                <h2 class="container__title" id="asn">
                    AS{{ asn }} - {{ as_name }}
                </h2>
            </div>
        </div>
    </div>
    <div class="asn__tabs">
        <div class="tabs__wrapper">
            <div class="wrapper__container">
                <div class="container__tabs" id="tabs">
                    <div class="tab__item tab__item--active" target="overview">
                        Overview
                    </div>
                    <div class="tab__item" target="prefixes">
                        All Prefixes
                    </div>
                    <div class="tab__item" target="connectivity">
                        Connectivity
                    </div>
                    <div class="tab__item" target="measurements">
                        Measurements
                    </div>
                    <div class="tab__item" target="whois">
                        Whois
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="asn__content">
        <div class="content__wrapper">
            <div class="wrapper__container">
                <div class="container__content">
                    <div class="content__panel" id="overview" aria-labelledby="tab-overview">
                        <div class="panel__header">
                            <div class="header__description">
                                Dashboards sections can be used to organize cards with related content, and they can be collapse for quicker navigation of dashboards that contain a lot of content.
                            </div>
                            <div class="header__controls">
                                <cds-dropdown value="option-4" class="cds-theme-zone-white" size="lg" style="width: 18rem;">
                                    <cds-dropdown-item value="option-0">Last 5 minutes</cds-dropdown-item>
                                    <cds-dropdown-item value="option-1">Last 15 minutes</cds-dropdown-item>
                                    <cds-dropdown-item value="option-2">Last 30 minutes</cds-dropdown-item>
                                    <cds-dropdown-item value="option-3">Last 1 hour</cds-dropdown-item>
                                    <cds-dropdown-item value="option-4">Last 3 hours</cds-dropdown-item>
                                    <cds-dropdown-item value="option-5">Last 6 hours</cds-dropdown-item>
                                    <cds-dropdown-item value="option-6">Last 12 hours</cds-dropdown-item>
                                    <cds-dropdown-item value="option-7">Last 24 hours</cds-dropdown-item>
                                    <cds-dropdown-item value="option-8">Last 2 days</cds-dropdown-item>
                                    <cds-dropdown-item value="option-10">Last 7 days</cds-dropdown-item>
                                    <cds-dropdown-item value="option-11">Last 30 days</cds-dropdown-item>
                                </cds-dropdown>
                            </div>
                        </div>
                        <div class="panel__content">
                            <div class="content__metrics">
                                <div class="metrics__card">
                                    <div class="card__eyebrow">IPv4</div>
                                    <div class="card__description">Advertised IPv4 Prefixes</div>
                                    <div class="card__value">{{ ipv4_count }}</div>
                                </div>
                                <div class="metrics__card">
                                    <div class="card__eyebrow">IPv6</div>
                                    <div class="card__description">Advertised IPv6 Prefixes</div>
                                    <div class="card__value">{{ ipv6_count }}</div>
                                </div>
                                <div class="metrics__card">
                                    <div class="card__eyebrow">Upstream ASNs</div>
                                    <div class="card__description">Routes received from</div>
                                    <div class="card__value">{{ upstream_count }}</div>
                                </div>
                                <div class="metrics__card">
                                    <div class="card__eyebrow">Downstream ASNs</div>
                                    <div class="card__description">Routes provided to</div>
                                    <div class="card__value">{{ downstream_count }}</div>
                                </div>
                            </div>
                            <div class="content__charts">
                                <div class="charts__item charts__item--span-3-columns" id="trend-graph"></div>
                            </div>
                        </div>
                    </div>
                    <div class="content__panel" id="prefixes" aria-labelledby="tab-prefixes">
                        Tab Panel 2
                    </div>
                    <div class="content__panel" id="connectivity" aria-labelledby="tab-connectivity">
                        Tab Panel 3
                    </div>
                    <div class="content__panel" id="measurements" aria-labelledby="tab-measurements">
                        Tab Panel 4
                    </div>
                    <div class="content__panel" id="whois" aria-labelledby="tab-whois">
                        Tab Panel 5
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab__item');
    const panels = document.querySelectorAll('.content__panel');
    
    // Function to switch tabs
    const switchTab = (targetId) => {
        // Update URL hash without triggering scroll
        history.replaceState(null, null, `#${targetId}`);
        
        // Update active tab
        tabs.forEach(tab => {
            if (tab.getAttribute('target') === targetId) {
                tab.classList.add('tab__item--active');
            } else {
                tab.classList.remove('tab__item--active');
            }
        });
        
        // Show corresponding panel
        panels.forEach(panel => {
            if (panel.id === targetId) {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        });
    };
    
    // Add click handlers to tabs
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const targetId = tab.getAttribute('target');
            switchTab(targetId);
        });
    });
    
    // Handle initial load and hash changes
    const handleHashChange = () => {
        const hash = window.location.hash.slice(1) || 'overview';
        switchTab(hash);
    };
    
    // Listen for hash changes
    window.addEventListener('hashchange', handleHashChange);
    
    // Initial load
    handleHashChange();
});
</script>
<script>
    const data = {{ trend_data|tojson }}.flatMap(item => [
        { date: item.time, value: item.v4_prefixes, group: 'IPv4 Prefixes' },
        { date: item.time, value: item.v6_prefixes, group: 'IPv6 Prefixes' },
        { date: item.time, value: item.v4_with_rpki, group: 'IPv4 with RPKI' },
        { date: item.time, value: item.v6_with_rpki, group: 'IPv6 with RPKI' },
        { date: item.time, value: item.v4_with_irr, group: 'IPv4 with IRR' },
        { date: item.time, value: item.v6_with_irr, group: 'IPv6 with IRR' }
    ]);
    console.log(data);
    // Grab chart holder HTML element and initialize the chart
    new Charts.LineChart(document.getElementById("trend-graph"), {
        data,
        options: {
            "title": 'Originating Prefix Trend',
            "axes": {
                "bottom": {
                    "title": 'Time',
                    "mapsTo": 'date',
                    "scaleType": 'time'
                },
                "left": {
                    "mapsTo": 'value',
                    "title": 'Count',
                    "scaleType": 'linear'
                }
            },
            "curve": 'curveMonotoneX',
            "height": '400px',
            "theme": "white",
            "color": {
                "scale": {
                    "IPv4 Prefixes": "#1c486f",
                    "IPv6 Prefixes": "#c7c7c7",
                    "IPv4 with RPKI": "#1c486f",
                    "IPv6 with RPKI": "#c7c7c7",
                    "IPv4 with IRR": "#1c486f",
                    "IPv6 with IRR": "#c7c7c7"
                }
            }
        }
    });
</script>
{% endblock %}